dist: xenial
sudo: required

env:
  - DOTNET_SKIP_FIRST_TIME_EXPERIENCE=true
  - DOTNET_CLI_TELEMETRY_OPTOUT=1

addons:
  snaps:
  - name: dotnet-sdk
    confinement: classic
    channel: 3.1/stable

install:
  - sudo snap alias dotnet-sdk.dotnet dotnet

script:
  - dotnet --list-sdks

  - sudo snap refresh dotnet-sdk --channel=5.0/beta
  - dotnet --list-sdks

  - dotnet test --framework netcoreapp5.0 --configuration Release

  - sudo snap refresh dotnet-sdk --channel=2.1/stable
  - dotnet --list-sdks

  - dotnet test --framework netcoreapp2.0 --configuration Release
  - dotnet test --framework netcoreapp2.1 --configuration Release
  - dotnet test --framework netcoreapp2.2 --configuration Release

  - sudo snap refresh dotnet-sdk --channel=3.1/stable
  - dotnet --list-sdks

  - dotnet test --framework netcoreapp3.0 --configuration Release
  - dotnet test --framework netcoreapp3.1 --configuration Release /p:CollectCoverage=true /p:CopyLocalLockFileAssemblies=true /p:UseSourceLink=true /p:CoverletOutput=../TestResult/ /p:CoverletOutputFormat=opencover

  - csmacnz.Coveralls --opencover -i ./TestResult/coverage.opencover.xml --useRelativePaths --commitId $TRAVIS_COMMIT --commitBranch $TRAVIS_BRANCH --commitAuthor "$REPO_COMMIT_AUTHOR" --commitEmail "$REPO_COMMIT_AUTHOR_EMAIL" --commitMessage "$REPO_COMMIT_MESSAGE" --jobId $TRAVIS_JOB_ID  --serviceName travis-ci